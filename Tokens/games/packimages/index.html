<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card Pack Opener</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#121212;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
    overflow-x:hidden;
}

#top-bar {
    display:flex;
    gap:20px;
    align-items:center;
    font-size:18px;
    margin-bottom:20px;
}
#top-bar img { width:24px; height:24px; vertical-align:middle; margin-right:5px; }

.pack {
    width:200px;
    height:300px;
    margin:20px;
    cursor:pointer;
    border-radius:10px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    align-items:center;
    border:2px solid #fff;
    transition: transform 0.3s ease;
}
.pack:hover { transform: scale(1.05); }
.pack.disabled { pointer-events:none; opacity:0.5; }
.pack img { width:100%; height:100%; object-fit:contain; }

.pack-price {
    width:100%;
    text-align:center;
    background:#222;
    padding:5px;
    font-weight:bold;
}

#animation-container {
    position:fixed;
    bottom:-400px;
    left:50%;
    transform:translateX(-50%);
    width:200px;
    height:300px;
    pointer-events:none;
    z-index:1000;
}
#animation-container img {
    width:100%;
    height:100%;
    border-radius:10px;
    object-fit:contain;
}

#card-display {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0);
    width:200px;
    height:300px;
    border-radius:10px;
    z-index:1001;
    transition: transform 0.6s ease, box-shadow 0.6s ease;
    overflow:hidden;
}
#card-display img {
    width:100%;
    height:100%;
    border-radius:10px;
    object-fit:contain;
}

#rarity-bar {
    position:absolute;
    bottom:0;
    width:100%;
    padding:5px;
    text-align:center;
    font-weight:bold;
    background:rgba(0,0,0,0.6);
}

#inventory {
    margin-top:30px;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
}

.inventory-card {
    margin:10px;
    position:relative;
    width:120px;
    transition: transform 0.2s ease;
}
.inventory-card:hover { transform: scale(1.08); }

.inventory-card img {
    width:120px;
    height:180px;
    border-radius:8px;
    object-fit:contain;
}

.card-name {
    text-align:center;
    padding:3px;
    font-weight:bold;
    border-radius:0 0 8px 8px;
    overflow:hidden;
    white-space:nowrap;
}

.sell-btn {
    position:absolute;
    top:6px;
    right:6px;
    font-size:12px;
    border:none;
    border-radius:4px;
    background:#ff5555cc;
    color:#fff;
    cursor:pointer;
}

.sell-price {
    position:absolute;
    top:28px;
    right:4px;
    background:#000c;
    font-size:11px;
    padding:2px 6px;
    border-radius:6px;
}

@keyframes sparkle {
    0% { transform: scale(0.5); opacity:0; }
    50% { transform: scale(1); opacity:1; }
    100% { transform: scale(0.7); opacity:0; }
}
.sparkle {
    position:absolute;
    width:12px;
    height:12px;
    background:radial-gradient(circle,#fff,#ff0,transparent);
    border-radius:50%;
    animation:sparkle 1s ease-out forwards;
}
</style>
</head>

<body>

<h1>Card Pack Opener</h1>

<div id="top-bar">
  <div id="tokens"><img src="https://www.wtfq.online/Tokens/token.png">Tokens: 5</div>
  <div id="coins"><img src="https://www.wtfq.online/Tokens/coin.png">Coins: 0</div>
</div>

<div id="packs-container"></div>
<div id="animation-container"></div>

<div id="card-display">
    <img id="card-img">
    <div id="rarity-bar"></div>
</div>

<h2>Inventory</h2>
<div id="inventory"></div>

<script>
/* ===========================
   GLOBAL DATA
=========================== */

const rarities = ['Common','Uncommon','Rare','Epic','Legendary','Divine'];

const packPrices = {
    Common:1, Uncommon:2, Rare:3, Epic:5, Legendary:8, Divine:12
};

const rarityColors = {
    Common:'gray',
    Uncommon:'green',
    Rare:'blue',
    Epic:'purple',
    Legendary:'orange',
    Divine:'red'
};

const rarityLevels = {
    Common:0, Uncommon:1, Rare:2, Epic:3, Legendary:4, Divine:5
};

let tokens = Number(localStorage.getItem('tokens')) || 5;
let coins = Number(localStorage.getItem('coins')) || 0;

/* ðŸ”‘ INVENTORY STORES **ONLY CARD NAMES** */
let inventory = JSON.parse(localStorage.getItem('inventory') || '[]');

let cardsList = [];

/* ===========================
   INIT
=========================== */

(async function init(){
    cardsList = await fetch('cards/cards.json').then(r=>r.json());
    createPacks();
    updateTokens();
    updateCoins();
    updateInventory();
})();

/* ===========================
   PACK CREATION
=========================== */

function createPacks(){
    const container = document.getElementById('packs-container');
    container.innerHTML = '';

    rarities.forEach(rarity=>{
        const pack = document.createElement('div');
        pack.className = 'pack';
        pack.innerHTML = `
            <img src="${rarity}.png" onerror="this.style.background='${rarityColors[rarity]}';this.src=''">
            <div class="pack-price">Cost: ${packPrices[rarity]} Tokens</div>
        `;
        pack.onclick = ()=>openPackAnimation(rarity);
        container.appendChild(pack);
    });
}

/* ===========================
   PACK LOGIC
=========================== */

function getRandomRarity(base){
    const roll = Math.random()*100;
    const table = {
        Common:[84,94,98,99,99.9,100],
        Uncommon:[0,85,95,99,99.9,100],
        Rare:[0,0,85,95,99,100],
        Epic:[0,0,0,85,95,100],
        Legendary:[0,0,0,0,90,100],
        Divine:[0,0,0,0,10,100]
    };

    const baseLevel = rarityLevels[base];
    for(let i=baseLevel;i<rarities.length;i++){
        if(roll < table[base][i]) return rarities[i];
    }
    return base;
}

function pickWeighted(cards){
    const total = cards.reduce((s,c)=>s+(c.chance||1),0);
    let r = Math.random()*total;
    for(const c of cards){
        r -= (c.chance||1);
        if(r<=0) return c;
    }
    return cards[0];
}

async function openPackAnimation(rarity){
    if(tokens < packPrices[rarity]) return alert('Not enough tokens');

    tokens -= packPrices[rarity];
    updateTokens();

    const rarityResult = getRandomRarity(rarity);
    const pool = cardsList.filter(c=>c.rarity===rarityResult);
    const card = pickWeighted(pool);

    revealCard(card);

    /* ðŸ”‘ SAVE ONLY NAME */
    inventory.push(card.name);
    localStorage.setItem('inventory', JSON.stringify(inventory));

    updateInventory();
}

/* ===========================
   CARD DISPLAY
=========================== */

function revealCard(card){
    const display = document.getElementById('card-display');
    const img = document.getElementById('card-img');
    const bar = document.getElementById('rarity-bar');

    img.src = 'cards/' + card.image;
    bar.textContent = card.name;
    bar.style.background = rarityColors[card.rarity];

    display.style.transform = 'translate(-50%,-50%) scale(1)';
    display.style.boxShadow = `0 0 30px ${rarityColors[card.rarity]}`;

    setTimeout(()=>{
        display.style.transform = 'translate(-50%,-50%) scale(0)';
        display.style.boxShadow = 'none';
    },2000);
}

/* ===========================
   INVENTORY
=========================== */

function updateInventory(){
    const inv = document.getElementById('inventory');
    inv.innerHTML = '';

    inventory.forEach((name,index)=>{
        const card = cardsList.find(c=>c.name===name);
        if(!card) return;

        const div = document.createElement('div');
        div.className = 'inventory-card';
        div.innerHTML = `
            <img src="cards/${card.image}">
            <div class="card-name" style="background:${rarityColors[card.rarity]}">${card.name}</div>
            <button class="sell-btn" onclick="sellCard(${index})">Sell</button>
            <div class="sell-price">${card.coinWorth||1} Coins</div>
        `;
        inv.appendChild(div);
    });
}

function sellCard(index){
    const name = inventory[index];
    const card = cardsList.find(c=>c.name===name);
    if(!card) return;

    coins += card.coinWorth || 1;
    inventory.splice(index,1);

    localStorage.setItem('coins', coins);
    localStorage.setItem('inventory', JSON.stringify(inventory));

    updateCoins();
    updateInventory();
}

/* ===========================
   UI
=========================== */

function updateTokens(){
    document.getElementById('tokens').innerHTML =
        `<img src="https://www.wtfq.online/Tokens/token.png">Tokens: ${tokens}`;
    localStorage.setItem('tokens', tokens);
}

function updateCoins(){
    document.getElementById('coins').innerHTML =
        `<img src="https://www.wtfq.online/Tokens/coin.png">Coins: ${coins}`;
    localStorage.setItem('coins', coins);
}
</script>

</body>
</html>
