<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tokens / Coins</title>
<link rel="icon" type="image/png" href="/images/Math header.png">

<style>
:root { --gap: 12px; }
* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 24px;
  background: #0f172a;
  color: #e2e8f0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  text-align: center;
}

h1 { font-size: 3rem; margin-bottom: 16px; }

.currency-display {
  display: flex;
  justify-content: center;
  gap: 32px;
  margin-bottom: 24px;
  font-size: 1.8rem;
  align-items: center;
}

.currency-display img {
  width: 36px;
  height: 36px;
}

.button {
  padding: 12px 18px;
  border-radius: 14px;
  background: #1f2937;
  color: #f8fafc;
  border: 1px solid #334155;
  cursor: pointer;
  margin-bottom: 24px;
  font-weight: 600;
}
.button:disabled { opacity: .5; cursor: not-allowed; }

/* ================== SPILL ================== */

.scroll-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
  overflow: visible; /* VIKTIG: hindrer klipping */
}

.scroll-bar {
  display: flex;
  gap: var(--gap);
  overflow-x: auto;
  padding: 24px 12px; /* luft for hover */
}

/* KNAPP 5:6 */
.game-button {
  width: 170px;
  aspect-ratio: 5 / 6;
  background: #1f2937;
  border: 1px solid #334155;
  border-radius: 16px;
  cursor: pointer;
  transition: transform .15s ease, border-color .15s ease;
  display: flex;
  flex-direction: column;
  overflow: visible; /* IKKE hidden */
}

.game-button:hover {
  transform: translateY(-8px);
  border-color: #475569;
}

/* BILDE 1:1 */
.game-image {
  width: 100%;
  aspect-ratio: 1 / 1;
  padding: 10px;
}

.game-image img {
  width: 100%;
  height: 100%;
  object-fit: contain; /* IKKE croppet */
}

/* TEKST UNDER */
.game-label {
  padding: 8px;
  font-weight: 600;
  font-size: 0.95rem;
  text-align: center;
  background: rgba(0,0,0,0.35);
  border-bottom-left-radius: 16px;
  border-bottom-right-radius: 16px;
}

/* ================== MODAL ================== */
#modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  z-index: 900;
}

#game-modal {
  position: fixed;
  inset: 50%;
  transform: translate(-50%,-50%);
  width: 90%;
  height: 80%;
  background: #0f172a;
  border: 2px solid #334155;
  border-radius: 16px;
  display: none;
  z-index: 1000;
}

#game-modal iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 14px;
}
</style>
</head>
<body>

<div class="container">
  <h1>What The Facqkuit</h1>

  <div class="currency-display">
    <div>
      <img src="coin.png">
      <div><span id="coins-count">0</span> Coins</div>
    </div>
    <div>
      <img src="token.png">
      <div><span id="tokens-count">0</span> Tokens</div>
    </div>
  </div>

  <button class="button" id="convert-button">Bytt Coins til Tokens</button>

  <h2>Spill for å tjene Coins:</h2>
  <div class="scroll-wrapper">
    <div class="scroll-bar" id="games-scrollbar"></div>
  </div>
</div>

<div id="modal-overlay"></div>
<div id="game-modal"><iframe id="game-iframe"></iframe></div>

<script>
/* ================== EN TOKEN-FANE ================== */
(function(){
  const key = "activeTokensTab";
  const msg = `
    <h1 style="text-align:center;margin-top:60px">
    En annen Token meny er åpnet!<br>
    Denne fanen er deaktivert.
    </h1>`;

  if(localStorage.getItem(key)){
    document.body.innerHTML = msg;
    return;
  }

  const id = Date.now()+"-"+Math.random();
  localStorage.setItem(key,id);

  window.addEventListener("beforeunload",()=>{
    if(localStorage.getItem(key)===id) localStorage.removeItem(key);
  });

  setInterval(()=>{
    if(localStorage.getItem(key)!==id){
      document.body.innerHTML = msg;
    }
  },500);

  window.addEventListener("storage",e=>{
    if(e.key===key && e.newValue!==id){
      document.body.innerHTML = msg;
    }
  });
})();

/* ================== COINS ================== */
function getCookie(n){
  const m=document.cookie.match(new RegExp('(^| )'+n+'=([^;]+)'));
  return m?+m[2]:0;
}
function setCookie(n,v,d=365){
  const t=new Date(Date.now()+d*864e5).toUTCString();
  document.cookie=`${n}=${v};expires=${t};path=/`;
}

let coins=getCookie("coins"),tokens=getCookie("tokens");
const coinsEl=document.getElementById("coins-count");
const tokensEl=document.getElementById("tokens-count");
const btn=document.getElementById("convert-button");

function update(){
  coinsEl.textContent=coins.toLocaleString();
  tokensEl.textContent=tokens.toLocaleString();
  btn.disabled=coins<10000;
}
setInterval(()=>{
  coins=getCookie("coins");
  tokens=getCookie("tokens");
  update();
},1000);
update();

btn.onclick=()=>{
  if(coins>=10000){
    const t=Math.floor(coins/10000);
    coins-=t*10000;
    tokens+=t;
    setCookie("coins",coins);
    setCookie("tokens",tokens);
    update();
  }
};

/* ================== SPILL ================== */
const games=[
  {name:"Clicker",img:"game1.png",url:"/Tokens/games/Clicker.html"}
];

const bar=document.getElementById("games-scrollbar");
const overlay=document.getElementById("modal-overlay");
const modal=document.getElementById("game-modal");
const iframe=document.getElementById("game-iframe");

games.forEach(g=>{
  const b=document.createElement("div");
  b.className="game-button";

  const imgWrap=document.createElement("div");
  imgWrap.className="game-image";
  const img=document.createElement("img");
  img.src=g.img;
  imgWrap.appendChild(img);

  const label=document.createElement("div");
  label.className="game-label";
  label.textContent=g.name;

  b.append(imgWrap,label);
  b.onclick=()=>{
    overlay.style.display="block";
    modal.style.display="block";
    iframe.src=g.url;
  };
  bar.appendChild(b);
});

overlay.onclick=()=>{
  iframe.src="";
  modal.style.display="none";
  overlay.style.display="none";
};

document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    iframe.src="";
    modal.style.display="none";
    overlay.style.display="none";
  }
});
</script>

</body>
</html>
