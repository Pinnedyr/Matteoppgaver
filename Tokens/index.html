<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tokens / Coins</title>
<link rel="icon" type="image/png" href="/images/Math header.png">

<style>
:root { --gap: 12px; }
* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 24px;
  background: #0f172a;
  color: #e2e8f0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  text-align: center;
}

h1 { font-size: 3rem; margin-bottom: 16px; }

.currency-display {
  display: flex;
  justify-content: center;
  gap: 32px;
  margin-bottom: 24px;
  font-size: 1.8rem;
  align-items: center;
}

.currency-display img {
  width: 36px;
  height: 36px;
}

.button {
  display: inline-block;
  padding: 12px 18px;
  border-radius: 14px;
  background: #1f2937;
  color: #f8fafc;
  border: 1px solid #334155;
  cursor: pointer;
  margin-bottom: 24px;
  transition: background .15s ease, border-color .15s ease, transform .04s ease;
  font-weight: 600;
}
.button:hover { background: #111827; border-color: #475569; }
.button:disabled { opacity: .5; cursor: not-allowed; }

.scroll-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
  overflow: visible;
}
.scroll-bar {
  display: flex;
  overflow-x: auto;
  gap: var(--gap);
  padding: 20px 0;
  margin-bottom: 24px;
}
.scroll-bar::-webkit-scrollbar { height: 8px; }
.scroll-bar::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }

/* ===== SPILLKNAPP ===== */
.game-button {
  width: 160px;
  aspect-ratio: 5 / 6;
  flex-shrink: 0;
  border-radius: 16px;
  border: 1px solid #334155;
  background: #1f2937;
  cursor: pointer;
  transition: transform .15s ease, border-color .15s ease;
  overflow: visible;
  position: relative;
}
.game-button:hover {
  transform: translateY(-10px);
  border-color: #475569;
}

.game-inner {
  width: 100%;
  height: 100%;
  border-radius: 16px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* 1:1 bilde uten crop */
.game-image {
  width: 100%;
  aspect-ratio: 1 / 1;
  background: #020617;
  display: flex;
  align-items: center;
  justify-content: center;
}
.game-image img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

/* Tekst under bildet */
.game-label {
  flex: 1;
  background: rgba(0,0,0,.8);
  color: #f8fafc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: .95rem;
  padding: 6px;
  text-align: center;
}

/* ===== MODAL ===== */
#game-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 90%;
  max-width: 1200px;
  height: 80%;
  transform: translate(-50%, -50%);
  background: #0f172a;
  border: 2px solid #334155;
  border-radius: 14px;
  display: none;
  z-index: 1000;
}
#game-modal iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 12px;
}

#modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  z-index: 900;
}
</style>
</head>

<body>

<div class="container">
  <h1>What The Facqkuit</h1>

  <div class="currency-display">
    <div>
      <img src="coin.png">
      <div><span id="coins-count">0</span> Coins</div>
    </div>
    <div>
      <img src="token.png">
      <div><span id="tokens-count">0</span> Tokens</div>
    </div>
  </div>

  <button class="button" id="convert-button">Bytt Coins til Tokens</button>

  <h2>Spill for 책 tjene Coins:</h2>
  <div class="scroll-wrapper">
    <div class="scroll-bar" id="games-scrollbar"></div>
  </div>
</div>

<div id="modal-overlay"></div>
<div id="game-modal">
  <iframe id="game-iframe"></iframe>
</div>

<script>
/* ================== EN FANE /Tokens/ ================== */
(function(){
  const lockKey="activeTokensTab";

  if(localStorage.getItem(lockKey)){
    document.body.innerHTML=`
      <h1 style="color:white;text-align:center;margin-top:60px;">
      En annen Token meny er 책pnet!<br>
      Denne fanen er deaktivert.
      </h1>`;
    return;
  }

  const tabId=Date.now()+"-"+Math.random();
  localStorage.setItem(lockKey,tabId);

  window.addEventListener("beforeunload",()=>{
    if(localStorage.getItem(lockKey)===tabId)
      localStorage.removeItem(lockKey);
  });

  setInterval(()=>{
    if(localStorage.getItem(lockKey)!==tabId){
      document.body.innerHTML=`
        <h1 style="color:white;text-align:center;margin-top:60px;">
        En annen Token meny er 책pnet!<br>
        Denne fanen er deaktivert.
        </h1>`;
    }
  },500);

  window.addEventListener("storage",e=>{
    if(e.key===lockKey && e.newValue!==tabId){
      document.body.innerHTML=`
        <h1 style="color:white;text-align:center;margin-top:60px;">
        En annen Token meny er 책pnet!<br>
        Denne fanen er deaktivert.
        </h1>`;
    }
  });
})();

/* ================== COOKIES ================== */
function getCookie(name){
  const m=document.cookie.match(new RegExp('(^| )'+name+'=([^;]+)'));
  return m && !isNaN(m[2]) ? parseInt(m[2]) : 0;
}
function setCookie(name,value,days=365){
  const d=new Date();
  d.setTime(d.getTime()+days*864e5);
  document.cookie=`${name}=${value};path=/;expires=${d.toUTCString()}`;
}

let coins=getCookie("coins");
let tokens=getCookie("tokens");

const coinsEl=document.getElementById("coins-count");
const tokensEl=document.getElementById("tokens-count");
const convertBtn=document.getElementById("convert-button");

function update(){
  coinsEl.textContent=coins.toLocaleString();
  tokensEl.textContent=tokens.toLocaleString();
  convertBtn.disabled=coins<10000;
}
setInterval(()=>{
  coins=getCookie("coins");
  tokens=getCookie("tokens");
  update();
},1000);
update();

convertBtn.onclick=()=>{
  if(coins>=10000){
    const t=Math.floor(coins/10000);
    coins-=t*10000;
    tokens+=t;
    setCookie("coins",coins);
    setCookie("tokens",tokens);
    update();
    alert(`${t} Token(s) lagt til!`);
  }
};

/* ================== SPILL ================== */
const games=[
  {name:"Clicker",img:"game1.png",url:"/Tokens/games/Clicker.html"}
];

const bar=document.getElementById("games-scrollbar");
const overlay=document.getElementById("modal-overlay");
const modal=document.getElementById("game-modal");
const iframe=document.getElementById("game-iframe");

games.forEach(g=>{
  const btn=document.createElement("div");
  btn.className="game-button";

  const inner=document.createElement("div");
  inner.className="game-inner";

  const imgWrap=document.createElement("div");
  imgWrap.className="game-image";
  const img=document.createElement("img");
  img.src=g.img;
  imgWrap.appendChild(img);

  const label=document.createElement("div");
  label.className="game-label";
  label.textContent=g.name;

  inner.appendChild(imgWrap);
  inner.appendChild(label);
  btn.appendChild(inner);

  btn.onclick=()=>{
    overlay.style.display="block";
    modal.style.display="block";
    iframe.src=g.url;
  };

  bar.appendChild(btn);
});

overlay.onclick=()=>{
  iframe.src="";
  modal.style.display="none";
  overlay.style.display="none";
};
document.addEventListener("keydown",e=>{
  if(e.key==="Escape") overlay.click();
});
</script>

</body>
</html>
