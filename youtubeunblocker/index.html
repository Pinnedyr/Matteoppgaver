<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Matteoppgaver</title>
  <link rel="icon" type="image/png" href="images/Math header.png">
  <script src="closeTab.js"></script>
  <style>
    :root { --gap: 12px; }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      margin: 0; padding: 24px; background: #0f172a; color: #e2e8f0;
      display: flex; flex-direction: column; align-items: center;
    }
    h1 { margin: 0 0 8px; font-size: 5.6rem; text-align: center; }
    p.subtitle { margin: 0 0 20px; opacity: 0.8; text-align: center; font-size: 1.2rem; }
    .controls { display: flex; gap: 8px; margin-bottom: 20px; }
    input { padding: 12px 14px; border-radius: 14px; border: 1px solid #334155; background: #1f2937; color: #f8fafc; font-size: 1rem; width: 300px; transition: background .15s ease, border-color .15s ease; }
    input:focus { background: #111827; border-color: #475569; }
    button { padding: 12px 18px; border-radius: 14px; border: 1px solid #334155; background: #1f2937; color: #f8fafc; cursor: pointer; font-size: 1rem; transition: background .15s ease, border-color .15s ease; }
    button:hover { background: #111827; border-color: #475569; }
    iframe { width: 80vw; height: 45vw; max-width: 1280px; max-height: 720px; border: none; border-radius: 12px; background: black; }
    #loading-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center;
      color: #f8fafc; font-size: 1.4rem; z-index: 999; display: none;
    }
    #loading-overlay p { margin: 8px 0; }
    #stop-btn { margin-top: 12px; padding: 10px 16px; font-size: 1rem; border-radius: 10px; border: 1px solid #334155; background: #1f2937; cursor: pointer; }
    #stop-btn:hover { background: #111827; border-color: #475569; }
  </style>
</head>
<body>
  <h1>What the facqkuit</h1>
  <p class="subtitle">Youtube Videospiller</p>

  <div class="controls">
    <input type="text" id="video-input" placeholder="Skriv inn YouTube-ID eller link" />
    <button id="play-btn">Tilfeldig video</button>
    <button id="load-btn">Last inn</button>
  </div>

  <iframe id="player" src=""></iframe>

  <!-- Laste-skjerm -->
  <div id="loading-overlay">
    <p>Laster tilfeldig video...</p>
    <p id="tries-counter">Prøvde 0 linker</p>
    <button id="stop-btn">Stopp</button>
  </div>

  <script>
    const iframe = document.getElementById("player");
    const playBtn = document.getElementById("play-btn");
    const loadBtn = document.getElementById("load-btn");
    const input = document.getElementById("video-input");
    const overlay = document.getElementById("loading-overlay");
    const triesCounter = document.getElementById("tries-counter");
    const stopBtn = document.getElementById("stop-btn");

    let stopFlag = false;

    function getRandomVideoId() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
      let id = "";
      for(let i=0;i<11;i++) id += chars.charAt(Math.floor(Math.random()*chars.length));
      return id;
    }

    async function checkVideo(id) {
      try {
        const res = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
        return res.ok;
      } catch(e) {
        return false;
      }
    }

    async function getValidVideo(initialId = null) {
      let id = initialId || getRandomVideoId();
      let tries = 0;
      overlay.style.display = "flex";
      stopFlag = false;
      input.disabled = true;
      playBtn.disabled = true;
      loadBtn.disabled = true;

      while(true) {
        if(stopFlag) {
          input.disabled = false;
          playBtn.disabled = false;
          loadBtn.disabled = false;
          return null;
        }
        tries++;
        triesCounter.textContent = `Prøvde ${tries} linker...`;

        const valid = await checkVideo(id);
        if(valid) {
          input.disabled = false;
          playBtn.disabled = false;
          loadBtn.disabled = false;
          return id; 
        }

        id = getRandomVideoId();
        await new Promise(r => setTimeout(r, 50)); 
      }
    }

    playBtn.addEventListener("click", async () => {
      input.value = ""; // Tøm input-feltet
      const validId = await getValidVideo();
      overlay.style.display = "none";
      if(validId) iframe.src = `https://www.youtube.com/embed/${validId}?autoplay=1`;
    });

    loadBtn.addEventListener("click", async () => {
      let id = input.value.trim();
      if(id.includes("youtube.com/watch?v=")) {
        id = id.split("v=")[1].split("&")[0];
      } else if(id.includes("youtu.be/")) {
        id = id.split("youtu.be/")[1].split("?")[0];
      }
      if(!id) return;

      overlay.style.display = "flex";
      stopFlag = false;
      input.disabled = true;
      playBtn.disabled = true;
      loadBtn.disabled = true;

      const validId = await getValidVideo(id);
      overlay.style.display = "none";
      if(validId) iframe.src = `https://www.youtube.com/embed/${validId}?autoplay=1`;
    });

    stopBtn.addEventListener("click", () => {
      stopFlag = true;
      location.reload();
    });
  </script>
</body>
</html>
